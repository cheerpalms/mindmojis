<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Decorate Your Photo</title>
  <style>
    html, body {
  margin: 0;
  height: 100%;
  font-family: Arial, sans-serif;
}

/* Flex container */
.customisation-wrap {
  height: 100vh;
  display: flex;
}
.wrap-flex {
  display: flex;
  width: 100%;
  height: 100%;
}

/* Left sidebar */
.wrap-left {
  width: 250px;
  background: url("sidebar-01.svg") no-repeat center center;
  background-size: cover;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: 2px 0 8px rgba(0,0,0,0.1);
}

/* Tabs */
.tab-header {
  display: flex;
  gap: 4px;
  margin-bottom: 10px;
}
.tab-btn {
  flex: 1;
  padding: 8px;
  cursor: pointer;
  border: none;
  background: #ddd;
  border-radius: 6px;
  font-weight: bold;
}
.tab-btn.active {
  background: #3286f2;
  color: #fff;
}

/* Tab content container */
.tab-content {
  flex: none;              /* allow fixed height */
  overflow-y: hidden;      /* outer container hides scroll */
}

/* Stickers grid */
.choices-wrap-stickers {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;

  /* Show 4 rows (8 stickers) */
  height: calc((100px + 10px) * 4); /* sticker height + gap * 4 rows */
  overflow-y: auto; /* scroll if more stickers */
}

.single-choice img.sticker {
  width: 100%;
  aspect-ratio: 1/1;
  cursor: pointer;
  border-radius: 8px;
  background: rgba(255,255,255,0.6);
  padding: 4px;
  height: 100px; /* matches the calculation above */
}

/* Right canvas */
.wrap-right {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  background: radial-gradient(#fffaff 10%, #b782f3 65%);
  position: relative;
}

#canvasWrapper {
  position: relative;
  width: 80%;
  aspect-ratio: 3 / 2; /* Optional: keeps canvas proportional */
  max-width: 800px;
}

#canvas {
  width: 100%;
  height: 100%;
  border: 4px solid #fff12d;
  border-radius: 16px;
  background: #eee;
  display: block;
}

#stickerLayer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2;
}

/* Draggable stickers */
.draggable-sticker {
  position: absolute;
  width: 80px;
  height: 80px;
  cursor: move;
  pointer-events: auto;
  user-select: none;
  transition: box-shadow 0.2s;
  box-shadow: 0 0 8px #3286f2;
}

.resize-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  background: #fff;
  border: 2px solid #3286f2;
  border-radius: 3px;
  z-index: 3;
}


.top-left { top: 0; left: 0; cursor: nwse-resize; }
.top-right { top: 0; right: 0; cursor: nesw-resize; }
.bottom-left { bottom: 0; left: 0; cursor: nesw-resize; }
.bottom-right { bottom: 0; right: 0; cursor: nwse-resize; }

  </style>
</head>
<body>
  <body>
    
  <div class="customisation-wrap">
    <div class="wrap-flex">

      <!-- Left sidebar with tabs -->
      <div class="wrap-left">
        <!-- Tabs -->
        <div class="tab-header">
          <button class="tab-btn active" data-target="stickers">Stickers</button>
          <button class="tab-btn" data-target="text">Text</button>
        </div>

        <!-- Tab content -->
        <div class="tab-content" id="stickers">
          <div class="choices-wrap choices-wrap-stickers">
            <div class="single-choice"><img src="emoji-02.svg" class="sticker" onclick="addSticker('emoji-02.svg')"></div>
            <div class="single-choice"><img src="emoji-03.svg" class="sticker" onclick="addSticker('emoji-03.svg')"></div>
            <div class="single-choice"><img src="emoji-04.svg" class="sticker" onclick="addSticker('emoji-04.svg')"></div>
            <div class="single-choice"><img src="emoji-05.svg" class="sticker" onclick="addSticker('emoji-05.svg')"></div>
            <div class="single-choice"><img src="emoji-06.svg" class="sticker" onclick="addSticker('emoji-06.svg')"></div>
            <div class="single-choice"><img src="emoji-07.svg" class="sticker" onclick="addSticker('emoji-07.svg')"></div>
            <div class="single-choice"><img src="emoji-08.svg" class="sticker" onclick="addSticker('emoji-08.svg')"></div>
            <div class="single-choice"><img src="emoji-09.svg" class="sticker" onclick="addSticker('emoji-09.svg')"></div>
            <div class="single-choice"><img src="emoji-10.svg" class="sticker" onclick="addSticker('emoji-10.svg')"></div>
            <div class="single-choice"><img src="emoji-11.svg" class="sticker" onclick="addSticker('emoji-11.svg')"></div>
            <div class="single-choice"><img src="emoji 2-02.svg" class="sticker" onclick="addSticker('emoji 2-02.svg')"></div>
            <div class="single-choice"><img src="emoji 2-03.svg" class="sticker" onclick="addSticker('emoji 2-03.svg')"></div>
            <div class="single-choice"><img src="emoji 2-04.svg" class="sticker" onclick="addSticker('emoji 2-04.svg')"></div>
            <div class="single-choice"><img src="emoji 2-05.svg" class="sticker" onclick="addSticker('emoji 2-05.svg')"></div>   
            <div class="single-choice"><img src="emoji 2-06.svg" class="sticker" onclick="addSticker('emoji 2-06.svg')"></div>
            <div class="single-choice"><img src="emoji 2-07.svg" class="sticker" onclick="addSticker('emoji 2-07.svg')"></div>
          </div>
        </div>

        <div class="tab-content" id="text" style="display: none;">
          <div class="choices-wrap choices-wrap-text">
            <div class="single-choice">Text Option 1</div>
            <div class="single-choice">Text Option 2</div>
            <div class="single-choice">Text Option 3</div>
          </div>
        </div>
      </div>

      <!-- Right canvas -->
      <div class="wrap-right">
  <div id="canvasWrapper">
    <canvas id="canvas" width="900" height="600"></canvas>
    <div id="stickerLayer"></div>

    </div>
    <button id="downloadBtn" onclick="downloadImage()" style="
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 100;
  padding: 10px 20px;
  background: #3286f2;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
">
  Download
</button>

  </div>
</body>
  <script>
const tabButtons = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    tabButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    tabContents.forEach(tc => tc.style.display = 'none');
    const target = document.getElementById(btn.dataset.target);
    target.style.display = 'block';
  });
});
    // Load user photo from localStorage
    window.onload = function() {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const userPhoto = localStorage.getItem('userPhoto');
      if (userPhoto) {
        const img = new Image();
        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          document.getElementById('main').style.width = img.width + 'px';
          document.getElementById('main').style.height = img.height + 'px';
          document.getElementById('stickerLayer').style.width = img.width + 'px';
          document.getElementById('stickerLayer').style.height = img.height + 'px';
        };
        img.src = userPhoto;
      }
    };

    // Add sticker as draggable/resizable element
   function addSticker(src) {
  const stickerLayer = document.getElementById('stickerLayer');
  
  const sticker = document.createElement('div');
  sticker.className = 'draggable-sticker';
  sticker.style.position = 'absolute';
  sticker.style.left = '40px';
  sticker.style.top = '40px';
  sticker.style.width = '80px';
  sticker.style.height = '80px';

  const img = document.createElement('img');
  img.src = src;
  img.style.width = '100%';
  img.style.height = '100%';
  img.style.pointerEvents = 'none'; // Prevent image from interfering with drag
  sticker.appendChild(img);

  // Add 4 resize handles
  const corners = ['tl', 'tr', 'bl', 'br'];
  corners.forEach(corner => {
    const handle = document.createElement('div');
    handle.className = 'resize-handle';
    handle.dataset.corner = corner;
    handle.style.position = 'absolute';
    handle.style.width = '10px';
    handle.style.height = '10px';
    handle.style.background = 'blue';
    handle.style.cursor = `${corner}-resize`;
    switch (corner) {
      case 'tl': handle.style.left = '0'; handle.style.top = '0'; break;
      case 'tr': handle.style.right = '0'; handle.style.top = '0'; break;
      case 'bl': handle.style.left = '0'; handle.style.bottom = '0'; break;
      case 'br': handle.style.right = '0'; handle.style.bottom = '0'; break;
    }
    sticker.appendChild(handle);
  });

  stickerLayer.appendChild(sticker);

  // Drag logic
  let offsetX, offsetY, isDragging = false;
  sticker.addEventListener('mousedown', function(e) {
    if (e.target.classList.contains('resize-handle')) return;
    isDragging = true;
    offsetX = e.clientX - sticker.offsetLeft;
    offsetY = e.clientY - sticker.offsetTop;
    sticker.style.zIndex = 10;
  });
  document.addEventListener('mousemove', function(e) {
    if (isDragging) {
      sticker.style.left = (e.clientX - offsetX) + 'px';
      sticker.style.top = (e.clientY - offsetY) + 'px';
    }
  });
  document.addEventListener('mouseup', function() {
    isDragging = false;
    sticker.style.zIndex = '';
  });
  // Touch drag support
sticker.addEventListener('touchstart', function(e) {
  if (e.target.classList.contains('resize-handle')) return;
  e.preventDefault(); // Prevent scrolling or layout shift
  isDragging = true;
  const touch = e.touches[0];
  const layerRect = stickerLayer.getBoundingClientRect();
  offsetX = touch.clientX - sticker.getBoundingClientRect().left + layerRect.left;
  offsetY = touch.clientY - sticker.getBoundingClientRect().top + layerRect.top;
  sticker.style.zIndex = 10;
});

document.addEventListener('touchmove', function(e) {
  if (isDragging) {
    const touch = e.touches[0];
    const layerRect = stickerLayer.getBoundingClientRect();
    sticker.style.left = (touch.clientX - layerRect.left - offsetX) + 'px';
    sticker.style.top = (touch.clientY - layerRect.top - offsetY) + 'px';
  }
});

document.addEventListener('touchend', function() {
  isDragging = false;
  sticker.style.zIndex = '';
});


  // Resize logic
  let isResizing = false, startX, startY, startW, startH, startLeft, startTop, currentCorner;
  sticker.querySelectorAll('.resize-handle').forEach(handle => {
    handle.addEventListener('mousedown', e => {
      e.stopPropagation();
      isResizing = true;
      currentCorner = handle.dataset.corner;
      startX = e.clientX;
      startY = e.clientY;
      startW = sticker.offsetWidth;
      startH = sticker.offsetHeight;
      startLeft = sticker.offsetLeft;
      startTop = sticker.offsetTop;
    });
  });

  document.addEventListener('mousemove', e => {
    if (!isResizing) return;
    let dx = e.clientX - startX;
    let dy = e.clientY - startY;
    let newW = startW, newH = startH, newLeft = startLeft, newTop = startTop;

    switch (currentCorner) {
      case 'tl':
        newW = Math.max(40, startW - dx);
        newH = Math.max(40, startH - dy);
        newLeft = startLeft + dx;
        newTop = startTop + dy;
        break;
      case 'tr':
        newW = Math.max(40, startW + dx);
        newH = Math.max(40, startH - dy);
        newTop = startTop + dy;
        break;
      case 'bl':
        newW = Math.max(40, startW - dx);
        newH = Math.max(40, startH + dy);
        newLeft = startLeft + dx;
        break;
      case 'br':
        newW = Math.max(40, startW + dx);
        newH = Math.max(40, startH + dy);
        break;
    }

    sticker.style.width = newW + 'px';
    sticker.style.height = newH + 'px';
    sticker.style.left = newLeft + 'px';
    sticker.style.top = newTop + 'px';
  });

  document.addEventListener('mouseup', () => isResizing = false);
}
// Handle both mouse and touch start
function startResize(e, handle) {
  e.stopPropagation();
  isResizing = true;
  currentCorner = handle.dataset.corner;

  const clientX = e.type.startsWith('touch') ? e.touches[0].clientX : e.clientX;
  const clientY = e.type.startsWith('touch') ? e.touches[0].clientY : e.clientY;

  startX = clientX;
  startY = clientY;
  startW = sticker.offsetWidth;
  startH = sticker.offsetHeight;
  startLeft = sticker.offsetLeft;
  startTop = sticker.offsetTop;
}

sticker.querySelectorAll('.resize-handle').forEach(handle => {
  handle.addEventListener('mousedown', e => startResize(e, handle));
  handle.addEventListener('touchstart', e => startResize(e, handle), { passive: false });
});

// Handle both mouse and touch move
function onMove(e) {
  if (!isResizing) return;

  const clientX = e.type.startsWith('touch') ? e.touches[0].clientX : e.clientX;
  const clientY = e.type.startsWith('touch') ? e.touches[0].clientY : e.clientY;

  let dx = clientX - startX;
  let dy = clientY - startY;
  let newW = startW, newH = startH, newLeft = startLeft, newTop = startTop;

  switch (currentCorner) {
    case 'tl':
      newW = Math.max(40, startW - dx);
      newH = Math.max(40, startH - dy);
      newLeft = startLeft + dx;
      newTop = startTop + dy;
      break;
    case 'tr':
      newW = Math.max(40, startW + dx);
      newH = Math.max(40, startH - dy);
      newTop = startTop + dy;
      break;
    case 'bl':
      newW = Math.max(40, startW - dx);
      newH = Math.max(40, startH + dy);
      newLeft = startLeft + dx;
      break;
    case 'br':
      newW = Math.max(40, startW + dx);
      newH = Math.max(40, startH + dy);
      break;
  }

  sticker.style.width = newW + 'px';
  sticker.style.height = newH + 'px';
  sticker.style.left = newLeft + 'px';
  sticker.style.top = newTop + 'px';
}

document.addEventListener('mousemove', onMove);
document.addEventListener('touchmove', onMove, { passive: false });

// End resize
document.addEventListener('mouseup', () => isResizing = false);
document.addEventListener('touchend', () => isResizing = false);



  
  </script>
</body>
</html>
<button id="downloadBtn" style="position:absolute; top:20px; right:20px; z-index:100;" onclick="downloadImage()">Download</button>

<script>
function downloadImage() {
  console.log("Download button clicked");
 

function downloadImage() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  // Redraw base photo
  const userPhoto = localStorage.getItem('userPhoto');
  if (!userPhoto) return;
  const img = new Image();
  img.onload = function() {
    // Draw base photo
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    // Draw all stickers
    const stickers = document.querySelectorAll('.draggable-sticker');
    stickers.forEach(stickerEl => {
      // Get sticker position and size
      const rect = stickerEl.getBoundingClientRect();
      const parentRect = canvas.getBoundingClientRect();
      const x = rect.left - parentRect.left;
      const y = rect.top - parentRect.top;
      const w = stickerEl.offsetWidth;
      const h = stickerEl.offsetHeight;
      // Draw sticker
      ctx.drawImage(stickerEl, x, y, w, h);
    });

    // Download the result
    const link = document.createElement('a');
    link.download = 'decorated-photo.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  };
  img.src = userPhoto;
}


</script>  console.log("Preparing to download image");